# 🚀 如何修复：合约地址无效，事件监听已禁用

## 问题分析

当你看到这个警告信息时：
```
合约地址无效，事件监听已禁用
```

这意味着应用启动时检测到 `TOKEN_CONTRACT_ADDRESS` 是零地址或未配置。

## 解决方案

### 第 1 步：获取你的合约地址

你在 Sepolia 测试网部署的合约地址应该是什么？

**查看方式：**
1. 打开 [Sepolia Etherscan](https://sepolia.etherscan.io/)
2. 搜索你的钱包地址
3. 找到部署交易，看合约地址

例如：`0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b`

### 第 2 步：更新 `.env` 文件

编辑项目根目录的 `.env` 文件：

**现在的配置（❌ 错误）：**
```env
TOKEN_CONTRACT_ADDRESS=0x0000000000000000000000000000000000000000
```

**应该改成（✅ 正确）：**
```env
TOKEN_CONTRACT_ADDRESS=0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b
```

⚠️ **注意：** 
- 地址必须以 `0x` 开头
- 后面是 40 个十六进制字符（共 42 位）
- 不要用零地址 `0x0000...`

### 第 3 步：保存并重启应用

```bash
# 停止当前运行的应用 (Ctrl+C)

# 重新启动
go run cmd/api/main.go
```

### 第 4 步：验证配置成功

启动应用后，如果看到这样的日志，说明配置成功：

```
启动区块链事件监听服务...
区块链事件监听服务启动成功
检测到事件: TX Hash=0x..., Block=..., 主题数=...
```

## 测试事件监听

配置好合约地址后，可以测试事件监听是否工作：

```bash
# 1. 查询已监听到的事件
curl http://localhost:8080/api/v1/events?page=1&pageSize=10

# 2. 在你的合约上执行一个 Transfer 交易

# 3. 应该能看到新事件被保存到数据库
```

## 常见错误

| 错误 | 原因 | 解决方案 |
|------|------|--------|
| 合约地址无效 | TOKEN_CONTRACT_ADDRESS 是零地址 | 设置真实合约地址 |
| 连接以太坊 RPC 失败 | SEPOLIA_RPC_URL 无效或无法访问 | 检查 RPC URL 和网络连接 |
| 查询事件日志失败 | RPC 响应超时 | 检查网络，重试 |

## 需要帮助？

1. 确认 `TOKEN_CONTRACT_ADDRESS` 格式正确
2. 重启应用
3. 查看启动日志是否有错误信息
4. 确保 Sepolia RPC URL 可以访问
