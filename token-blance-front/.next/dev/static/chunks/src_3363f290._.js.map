{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/web3/code/TokenBalanceX/token-blance-front/src/lib/constants.ts"],"sourcesContent":["// API 配置\r\nexport const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\r\n\r\n// 网络配置\r\nexport const NETWORKS: Record<string, {\r\n  chainId: number;\r\n  name: string;\r\n  rpcUrl: string;\r\n  explorerUrl: string;\r\n  symbol: string;\r\n  decimals: number;\r\n}> = {\r\n  localhost: {\r\n    chainId: 31337,\r\n    name: 'Hardhat Local',\r\n    rpcUrl: 'http://127.0.0.1:8545',\r\n    explorerUrl: '',\r\n    symbol: 'TBX',\r\n    decimals: 18\r\n  },\r\n  sepolia: {\r\n    chainId: 11155111,\r\n    name: 'Sepolia Testnet',\r\n    rpcUrl: 'https://sepolia.infura.io/v3/YOUR_INFURA_PROJECT_ID',\r\n    explorerUrl: 'https://sepolia.etherscan.io',\r\n    symbol: 'TBX',\r\n    decimals: 18\r\n  },\r\n  baseSepolia: {\r\n    chainId: 84532,\r\n    name: 'Base Sepolia Testnet',\r\n    rpcUrl: 'https://sepolia.base.org',\r\n    explorerUrl: 'https://sepolia.basescan.org',\r\n    symbol: 'TBX',\r\n    decimals: 18\r\n  }\r\n};\r\n\r\n// 积分计算费率\r\nexport const POINTS_RATE = 0.05;\r\n\r\n// 分页配置\r\nexport const DEFAULT_PAGE_SIZE = 20;\r\n\r\n// 时间格式化\r\nexport const DATE_FORMATS = {\r\n  DATE_ONLY: 'YYYY-MM-DD',\r\n  DATE_TIME: 'YYYY-MM-DD HH:mm:ss',\r\n  TIME_ONLY: 'HH:mm:ss',\r\n  DISPLAY: 'MM/DD HH:mm'\r\n};\r\n\r\n// 合约ABI (简化版本，实际使用时需要完整的ABI)\r\nexport const TOKEN_CONTRACT_ABI = [\r\n  'function balanceOf(address account) view returns (uint256)',\r\n  'function transfer(address to, uint256 amount) returns (bool)',\r\n  'function mint(address to, uint256 amount)',\r\n  'function burn(uint256 amount)',\r\n  'function totalSupply() view returns (uint256)',\r\n  'function decimals() view returns (uint8)',\r\n  'function symbol() view returns (string)',\r\n  'event Transfer(address indexed from, address indexed to, uint256 value)',\r\n  'event Mint(address indexed to, uint256 amount)',\r\n  'event Burn(address indexed from, uint256 amount)'\r\n];\r\n\r\n// 本地存储键\r\nexport const STORAGE_KEYS = {\r\n  WALLET_ADDRESS: 'wallet_address',\r\n  SELECTED_NETWORK: 'selected_network',\r\n  THEME: 'theme',\r\n  LANGUAGE: 'language'\r\n};"],"names":[],"mappings":"AAAA,SAAS;;;;;;;;;;;;;;;;;AACmB;AAArB,MAAM,eAAe,6DAAmC;AAGxD,MAAM,WAOR;IACH,WAAW;QACT,SAAS;QACT,MAAM;QACN,QAAQ;QACR,aAAa;QACb,QAAQ;QACR,UAAU;IACZ;IACA,SAAS;QACP,SAAS;QACT,MAAM;QACN,QAAQ;QACR,aAAa;QACb,QAAQ;QACR,UAAU;IACZ;IACA,aAAa;QACX,SAAS;QACT,MAAM;QACN,QAAQ;QACR,aAAa;QACb,QAAQ;QACR,UAAU;IACZ;AACF;AAGO,MAAM,cAAc;AAGpB,MAAM,oBAAoB;AAG1B,MAAM,eAAe;IAC1B,WAAW;IACX,WAAW;IACX,WAAW;IACX,SAAS;AACX;AAGO,MAAM,qBAAqB;IAChC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAGM,MAAM,eAAe;IAC1B,gBAAgB;IAChB,kBAAkB;IAClB,OAAO;IACP,UAAU;AACZ"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///E:/web3/code/TokenBalanceX/token-blance-front/src/utils/web3.ts"],"sourcesContent":["import { ethers } from 'ethers';\r\nimport { TOKEN_CONTRACT_ABI, NETWORKS } from '@/lib/constants';\r\nimport { NetworkConfig } from '@/types';\r\n\r\n// 格式化余额显示\r\nexport const formatBalance = (balance: string, decimals: number = 18): string => {\r\n  const etherValue = ethers.utils.formatUnits(balance, decimals);\r\n  return parseFloat(etherValue).toFixed(4);\r\n};\r\n\r\n// 格式化地址显示\r\nexport const formatAddress = (address: string, length: number = 6): string => {\r\n  if (!address) return '';\r\n  return `${address.slice(0, length)}...${address.slice(-length)}`;\r\n};\r\n\r\n// 验证地址有效性\r\nexport const isValidAddress = (address: string): boolean => {\r\n  return ethers.utils.isAddress(address);\r\n};\r\n\r\n// 格式化交易哈希\r\nexport const formatTxHash = (hash: string, length: number = 8): string => {\r\n  if (!hash) return '';\r\n  return `${hash.slice(0, length)}...${hash.slice(-length)}`;\r\n};\r\n\r\n// 获取区块链浏览器链接\r\nexport const getExplorerUrl = (hash: string, network: string): string => {\r\n  const networkConfig = NETWORKS[network];\r\n  if (!networkConfig || !networkConfig.explorerUrl) return '#';\r\n  \r\n  return `${networkConfig.explorerUrl}/tx/${hash}`;\r\n};\r\n\r\n// 获取地址浏览器链接\r\nexport const getExplorerAddressUrl = (address: string, network: string): string => {\r\n  const networkConfig = NETWORKS[network];\r\n  if (!networkConfig || !networkConfig.explorerUrl) return '#';\r\n  \r\n  return `${networkConfig.explorerUrl}/address/${address}`;\r\n};\r\n\r\n// 创建合约实例\r\nexport const createContractInstance = (\r\n  address: string, \r\n  provider: ethers.providers.Web3Provider\r\n): ethers.Contract => {\r\n  return new ethers.Contract(address, TOKEN_CONTRACT_ABI, provider);\r\n};\r\n\r\n// 获取代币余额\r\nexport const getTokenBalance = async (\r\n  contractAddress: string,\r\n  userAddress: string,\r\n  provider: ethers.providers.Web3Provider\r\n): Promise<string> => {\r\n  try {\r\n    const contract = createContractInstance(contractAddress, provider);\r\n    const balance = await contract.balanceOf(userAddress);\r\n    return balance.toString();\r\n  } catch (error) {\r\n    console.error('Failed to get token balance:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// 获取总供应量\r\nexport const getTotalSupply = async (\r\n  contractAddress: string,\r\n  provider: ethers.providers.Web3Provider\r\n): Promise<string> => {\r\n  try {\r\n    const contract = createContractInstance(contractAddress, provider);\r\n    const totalSupply = await contract.totalSupply();\r\n    return totalSupply.toString();\r\n  } catch (error) {\r\n    console.error('Failed to get total supply:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// 发送交易\r\nexport const sendTransaction = async (\r\n  contractAddress: string,\r\n  methodName: string,\r\n  params: any[],\r\n  provider: ethers.providers.Web3Provider\r\n): Promise<ethers.providers.TransactionResponse> => {\r\n  try {\r\n    const contract = createContractInstance(contractAddress, provider.getSigner());\r\n    const tx = await contract[methodName](...params);\r\n    return tx;\r\n  } catch (error) {\r\n    console.error(`Failed to send ${methodName} transaction:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// 等待交易确认\r\nexport const waitForTransaction = async (\r\n  tx: ethers.providers.TransactionResponse,\r\n  confirmations: number = 1\r\n): Promise<ethers.providers.TransactionReceipt> => {\r\n  try {\r\n    const receipt = await tx.wait(confirmations);\r\n    return receipt;\r\n  } catch (error) {\r\n    console.error('Transaction failed or was not confirmed:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// 检查钱包是否已连接\r\nexport const isWalletConnected = (): boolean => {\r\n  if (typeof window === 'undefined') return false;\r\n  return !!(window as any).ethereum?.selectedAddress;\r\n};\r\n\r\n// 声明全局window类型\r\ndeclare global {\r\n  interface Window {\r\n    ethereum?: any;\r\n  }\r\n}\r\n\r\n// 获取当前连接的账户\r\nexport const getCurrentAccount = async (): Promise<string | null> => {\r\n  if (typeof window === 'undefined') return null;\r\n  \r\n  try {\r\n    const accounts = await (window as any).ethereum.request({\r\n      method: 'eth_accounts'\r\n    });\r\n    return accounts[0] || null;\r\n  } catch (error) {\r\n    console.error('Failed to get current account:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// 连接钱包\r\nexport const connectWallet = async (): Promise<string> => {\r\n  if (typeof window === 'undefined') throw new Error('Wallet connection not supported in server environment');\r\n  \r\n  if (!(window as any).ethereum) {\r\n    throw new Error('MetaMask or other Web3 wallet is not installed');\r\n  }\r\n\r\n  try {\r\n    const accounts = await (window as any).ethereum.request({\r\n      method: 'eth_requestAccounts'\r\n    });\r\n    return accounts[0];\r\n  } catch (error) {\r\n    console.error('Failed to connect wallet:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// 切换网络\r\nexport const switchNetwork = async (chainId: number): Promise<void> => {\r\n  if (typeof window === 'undefined') throw new Error('Network switching not supported in server environment');\r\n  \r\n  try {\r\n    await (window as any).ethereum.request({\r\n      method: 'wallet_switchEthereumChain',\r\n      params: [{ chainId: `0x${chainId.toString(16)}` }],\r\n    });\r\n  } catch (error: any) {\r\n    // 如果网络不存在，添加网络\r\n    if (error.code === 4902) {\r\n      const networkConfig = Object.values(NETWORKS).find(n => n.chainId === chainId);\r\n      if (networkConfig) {\r\n        await addNetwork(networkConfig);\r\n      }\r\n    } else {\r\n      throw error;\r\n    }\r\n  }\r\n};\r\n\r\n// 添加网络\r\nexport const addNetwork = async (networkConfig: any): Promise<void> => {\r\n  if (typeof window === 'undefined') throw new Error('Network addition not supported in server environment');\r\n  \r\n  try {\r\n    await (window as any).ethereum.request({\r\n      method: 'wallet_addEthereumChain',\r\n      params: [\r\n        {\r\n          chainId: `0x${networkConfig.chainId.toString(16)}`,\r\n          chainName: networkConfig.name,\r\n          rpcUrls: [networkConfig.rpcUrl],\r\n          blockExplorerUrls: networkConfig.explorerUrl ? [networkConfig.explorerUrl] : undefined,\r\n          nativeCurrency: {\r\n            name: 'ETH',\r\n            symbol: 'ETH',\r\n            decimals: 18,\r\n          },\r\n        },\r\n      ],\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to add network:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// 格式化时间\r\nexport const formatTime = (timestamp: string | Date): string => {\r\n  const date = new Date(timestamp);\r\n  return date.toLocaleString();\r\n};\r\n\r\n// 计算时间差（小时）\r\nexport const calculateHoursDifference = (startTime: string, endTime: string): number => {\r\n  const start = new Date(startTime);\r\n  const end = new Date(endTime);\r\n  const diffMs = end.getTime() - start.getTime();\r\n  return diffMs / (1000 * 60 * 60);\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":["file:///E:/web3/code/TokenBalanceX/token-blance-front/src/utils/format.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx';\r\nimport { twMerge } from 'tailwind-merge';\r\n\r\n// 合并Tailwind CSS类名\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n\r\n// 格式化数字\r\nexport const formatNumber = (\r\n  value: string | number,\r\n  decimals: number = 2,\r\n  locale: string = 'en-US'\r\n): string => {\r\n  const num = typeof value === 'string' ? parseFloat(value) : value;\r\n  if (isNaN(num)) return '0';\r\n  \r\n  return new Intl.NumberFormat(locale, {\r\n    minimumFractionDigits: decimals,\r\n    maximumFractionDigits: decimals,\r\n  }).format(num);\r\n};\r\n\r\n// 格式化大数字（K, M, B）\r\nexport const formatLargeNumber = (value: string | number): string => {\r\n  const num = typeof value === 'string' ? parseFloat(value) : value;\r\n  if (isNaN(num)) return '0';\r\n  \r\n  if (num >= 1000000000) {\r\n    return formatNumber(num / 1000000000, 1) + 'B';\r\n  } else if (num >= 1000000) {\r\n    return formatNumber(num / 1000000, 1) + 'M';\r\n  } else if (num >= 1000) {\r\n    return formatNumber(num / 1000, 1) + 'K';\r\n  }\r\n  return formatNumber(num, 2);\r\n};\r\n\r\n// 格式化百分比\r\nexport const formatPercentage = (\r\n  value: string | number,\r\n  decimals: number = 2\r\n): string => {\r\n  const num = typeof value === 'string' ? parseFloat(value) : value;\r\n  if (isNaN(num)) return '0.00%';\r\n  \r\n  const formatted = formatNumber(num, decimals);\r\n  return num >= 0 ? `+${formatted}%` : `${formatted}%`;\r\n};\r\n\r\n// 格式化日期\r\nexport const formatDate = (\r\n  date: string | Date,\r\n  format: 'short' | 'long' | 'relative' = 'short'\r\n): string => {\r\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\r\n  \r\n  switch (format) {\r\n    case 'short':\r\n      return dateObj.toLocaleDateString();\r\n    case 'long':\r\n      return dateObj.toLocaleDateString('en-US', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n      });\r\n    case 'relative':\r\n      return getRelativeTime(dateObj);\r\n    default:\r\n      return dateObj.toLocaleDateString();\r\n  }\r\n};\r\n\r\n// 获取相对时间\r\nexport const getRelativeTime = (date: Date): string => {\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffMins = Math.floor(diffMs / (1000 * 60));\r\n  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\r\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n\r\n  if (diffMins < 1) {\r\n    return 'just now';\r\n  } else if (diffMins < 60) {\r\n    return `${diffMins} ${diffMins === 1 ? 'minute' : 'minutes'} ago`;\r\n  } else if (diffHours < 24) {\r\n    return `${diffHours} ${diffHours === 1 ? 'hour' : 'hours'} ago`;\r\n  } else if (diffDays < 7) {\r\n    return `${diffDays} ${diffDays === 1 ? 'day' : 'days'} ago`;\r\n  } else {\r\n    return date.toLocaleDateString();\r\n  }\r\n};\r\n\r\n// 防抖函数\r\nexport const debounce = <T extends (...args: any[]) => any>(\r\n  func: T,\r\n  delay: number\r\n): (...args: Parameters<T>) => void => {\r\n  let timeoutId: NodeJS.Timeout;\r\n  \r\n  return (...args: Parameters<T>) => {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => func(...args), delay);\r\n  };\r\n};\r\n\r\n// 节流函数\r\nexport const throttle = <T extends (...args: any[]) => any>(\r\n  func: T,\r\n  limit: number\r\n): (...args: Parameters<T>) => void => {\r\n  let inThrottle: boolean;\r\n  \r\n  return (...args: Parameters<T>) => {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n};\r\n\r\n// 复制到剪贴板\r\nexport const copyToClipboard = async (text: string): Promise<boolean> => {\r\n  try {\r\n    await navigator.clipboard.writeText(text);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Failed to copy to clipboard:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// 下载文件\r\nexport const downloadFile = (data: any, filename: string, type: string = 'json'): void => {\r\n  const blob = new Blob([JSON.stringify(data, null, 2)], { \r\n    type: `application/${type}` \r\n  });\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = `${filename}.${type}`;\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  URL.revokeObjectURL(url);\r\n};\r\n\r\n// 验证邮箱\r\nexport const isValidEmail = (email: string): boolean => {\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n  return emailRegex.test(email);\r\n};\r\n\r\n// 生成随机颜色\r\nexport const generateRandomColor = (): string => {\r\n  const colors = [\r\n    '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6',\r\n    '#ec4899', '#14b8a6', '#f97316', '#6366f1', '#84cc16'\r\n  ];\r\n  return colors[Math.floor(Math.random() * colors.length)];\r\n};\r\n\r\n// 计算积分增长率\r\nexport const calculateGrowthRate = (\r\n  current: number,\r\n  previous: number\r\n): number => {\r\n  if (previous === 0) return current > 0 ? 100 : 0;\r\n  return ((current - previous) / previous) * 100;\r\n};\r\n\r\n// 本地存储操作\r\nexport const storage = {\r\n  get: <T>(key: string): T | null => {\r\n    if (typeof window === 'undefined') return null;\r\n    \r\n    try {\r\n      const item = localStorage.getItem(key);\r\n      return item ? JSON.parse(item) : null;\r\n    } catch (error) {\r\n      console.error(`Failed to get storage item ${key}:`, error);\r\n      return null;\r\n    }\r\n  },\r\n  \r\n  set: <T>(key: string, value: T): void => {\r\n    if (typeof window === 'undefined') return;\r\n    \r\n    try {\r\n      localStorage.setItem(key, JSON.stringify(value));\r\n    } catch (error) {\r\n      console.error(`Failed to set storage item ${key}:`, error);\r\n    }\r\n  },\r\n  \r\n  remove: (key: string): void => {\r\n    if (typeof window === 'undefined') return;\r\n    \r\n    try {\r\n      localStorage.removeItem(key);\r\n    } catch (error) {\r\n      console.error(`Failed to remove storage item ${key}:`, error);\r\n    }\r\n  },\r\n  \r\n  clear: (): void => {\r\n    if (typeof window === 'undefined') return;\r\n    \r\n    try {\r\n      localStorage.clear();\r\n    } catch (error) {\r\n      console.error('Failed to clear storage:', error);\r\n    }\r\n  }\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 506, "column": 0}, "map": {"version":3,"sources":["file:///E:/web3/code/TokenBalanceX/token-blance-front/src/hooks/useWallet.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { ethers } from 'ethers';\r\nimport { WalletInfo } from '@/types';\r\nimport { connectWallet, getCurrentAccount, isWalletConnected, switchNetwork } from '@/utils/web3';\r\nimport { storage } from '@/utils/format';\r\nimport { STORAGE_KEYS, NETWORKS } from '@/lib/constants';\r\n\r\nexport const useWallet = () => {\r\n  const [walletInfo, setWalletInfo] = useState<WalletInfo>({\r\n    address: '',\r\n    chainId: 0,\r\n    balance: '0',\r\n    connected: false\r\n  });\r\n  const [provider, setProvider] = useState<ethers.providers.Web3Provider | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // 初始化钱包连接\r\n  const initializeWallet = useCallback(async () => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // 检查是否有Web3钱包\r\n      if (!(window as any).ethereum) {\r\n        throw new Error('MetaMask or other Web3 wallet is not installed');\r\n      }\r\n\r\n      // 创建Provider实例\r\n      const web3Provider = new ethers.providers.Web3Provider((window as any).ethereum);\r\n      setProvider(web3Provider);\r\n\r\n      // 检查是否已连接\r\n      if (isWalletConnected()) {\r\n        const accounts = await web3Provider.listAccounts();\r\n        if (accounts.length > 0) {\r\n          const address = accounts[0];\r\n          const balance = await web3Provider.getBalance(address);\r\n          const network = await web3Provider.getNetwork();\r\n\r\n          setWalletInfo({\r\n            address,\r\n            chainId: network.chainId,\r\n            balance: ethers.utils.formatEther(balance),\r\n            connected: true\r\n          });\r\n\r\n          // 保存到本地存储\r\n          storage.set(STORAGE_KEYS.WALLET_ADDRESS, address);\r\n          storage.set(STORAGE_KEYS.SELECTED_NETWORK, network.chainId.toString());\r\n        }\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Failed to initialize wallet:', err);\r\n      setError(err.message);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // 连接钱包\r\n  const connect = useCallback(async () => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const address = await connectWallet();\r\n      \r\n      if (provider) {\r\n        const balance = await provider.getBalance(address);\r\n        const network = await provider.getNetwork();\r\n\r\n        setWalletInfo({\r\n          address,\r\n          chainId: network.chainId,\r\n          balance: ethers.utils.formatEther(balance),\r\n          connected: true\r\n        });\r\n\r\n        storage.set(STORAGE_KEYS.WALLET_ADDRESS, address);\r\n        storage.set(STORAGE_KEYS.SELECTED_NETWORK, network.chainId.toString());\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Failed to connect wallet:', err);\r\n      setError(err.message);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [provider]);\r\n\r\n  // 断开钱包连接\r\n  const disconnect = useCallback(() => {\r\n    setWalletInfo({\r\n      address: '',\r\n      chainId: 0,\r\n      balance: '0',\r\n      connected: false\r\n    });\r\n    setProvider(null);\r\n\r\n    // 清除本地存储\r\n    storage.remove(STORAGE_KEYS.WALLET_ADDRESS);\r\n    storage.remove(STORAGE_KEYS.SELECTED_NETWORK);\r\n  }, []);\r\n\r\n  // 切换网络\r\n  const switchToNetwork = useCallback(async (chainId: number) => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      await switchNetwork(chainId);\r\n      \r\n      // 更新钱包信息\r\n      if (provider && walletInfo.address) {\r\n        const balance = await provider.getBalance(walletInfo.address);\r\n        const network = await provider.getNetwork();\r\n\r\n        setWalletInfo(prev => ({\r\n          ...prev,\r\n          chainId: network.chainId,\r\n          balance: ethers.utils.formatEther(balance)\r\n        }));\r\n\r\n        storage.set(STORAGE_KEYS.SELECTED_NETWORK, network.chainId.toString());\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Failed to switch network:', err);\r\n      setError(err.message);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [provider, walletInfo.address]);\r\n\r\n  // 刷新余额\r\n  const refreshBalance = useCallback(async () => {\r\n    if (!provider || !walletInfo.address) return;\r\n\r\n    try {\r\n      const balance = await provider.getBalance(walletInfo.address);\r\n      setWalletInfo(prev => ({\r\n        ...prev,\r\n        balance: ethers.utils.formatEther(balance)\r\n      }));\r\n    } catch (err: any) {\r\n      console.error('Failed to refresh balance:', err);\r\n      setError(err.message);\r\n    }\r\n  }, [provider, walletInfo.address]);\r\n\r\n  // 监听账户变化\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const handleAccountsChanged = (accounts: string[]) => {\r\n      if (accounts.length === 0) {\r\n        disconnect();\r\n      } else if (accounts[0] !== walletInfo.address) {\r\n        initializeWallet();\r\n      }\r\n    };\r\n\r\n    const handleChainChanged = (chainId: string) => {\r\n      const newChainId = parseInt(chainId, 16);\r\n      setWalletInfo(prev => ({\r\n        ...prev,\r\n        chainId: newChainId\r\n      }));\r\n      storage.set(STORAGE_KEYS.SELECTED_NETWORK, newChainId.toString());\r\n      initializeWallet();\r\n    };\r\n\r\n    const handleDisconnect = () => {\r\n      disconnect();\r\n    };\r\n\r\n    // 添加事件监听器\r\n    if ((window as any).ethereum) {\r\n      (window as any).ethereum.on('accountsChanged', handleAccountsChanged);\r\n      (window as any).ethereum.on('chainChanged', handleChainChanged);\r\n      (window as any).ethereum.on('disconnect', handleDisconnect);\r\n    }\r\n\r\n    // 清理事件监听器\r\n    return () => {\r\n      if ((window as any).ethereum) {\r\n        (window as any).ethereum.removeListener('accountsChanged', handleAccountsChanged);\r\n        (window as any).ethereum.removeListener('chainChanged', handleChainChanged);\r\n        (window as any).ethereum.removeListener('disconnect', handleDisconnect);\r\n      }\r\n    };\r\n  }, [walletInfo.address, disconnect, initializeWallet]);\r\n\r\n  // 初始化时自动连接\r\n  useEffect(() => {\r\n    initializeWallet();\r\n  }, []);\r\n\r\n  // 定期刷新余额\r\n  useEffect(() => {\r\n    if (!walletInfo.connected) return;\r\n\r\n    const interval = setInterval(() => {\r\n      refreshBalance();\r\n    }, 10000); // 每10秒刷新一次\r\n\r\n    return () => clearInterval(interval);\r\n  }, [walletInfo.connected, refreshBalance]);\r\n\r\n  return {\r\n    walletInfo,\r\n    provider,\r\n    isLoading,\r\n    error,\r\n    connect,\r\n    disconnect,\r\n    switchToNetwork,\r\n    refreshBalance,\r\n    initializeWallet\r\n  };\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 767, "column": 0}, "map": {"version":3,"sources":["file:///E:/web3/code/TokenBalanceX/token-blance-front/src/contexts/Web3Context.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { ethers } from 'ethers';\r\nimport { useWallet } from '@/hooks/useWallet';\r\nimport { sendTransaction, waitForTransaction, getTokenBalance } from '@/utils/web3';\r\nimport { TransactionStatus, ContractInteraction } from '@/types';\r\nimport { toast } from 'react-hot-toast';\r\n\r\ninterface Web3ContextType {\r\n  provider: ethers.providers.Web3Provider | null;\r\n  isConnected: boolean;\r\n  address: string | null;\r\n  chainId: number;\r\n  connectWallet: () => Promise<void>;\r\n  disconnectWallet: () => void;\r\n  switchNetwork: (chainId: number) => Promise<void>;\r\n  sendTokenTransaction: (\r\n    contractAddress: string,\r\n    interaction: ContractInteraction\r\n  ) => Promise<string>;\r\n  getTokenBalance: (contractAddress: string, userAddress?: string) => Promise<string>;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n}\r\n\r\nconst Web3Context = createContext<Web3ContextType | undefined>(undefined);\r\n\r\nexport const Web3Provider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const {\r\n    walletInfo,\r\n    provider,\r\n    isLoading,\r\n    error,\r\n    connect,\r\n    disconnect,\r\n    switchToNetwork,\r\n    refreshBalance\r\n  } = useWallet();\r\n\r\n  const [transactions, setTransactions] = useState<Map<string, TransactionStatus>>(new Map());\r\n\r\n  // 连接钱包\r\n  const handleConnectWallet = async () => {\r\n    try {\r\n      await connect();\r\n      toast.success('Wallet connected successfully!');\r\n    } catch (error: any) {\r\n      console.error('Failed to connect wallet:', error);\r\n      toast.error(error.message || 'Failed to connect wallet');\r\n    }\r\n  };\r\n\r\n  // 断开钱包连接\r\n  const handleDisconnectWallet = () => {\r\n    disconnect();\r\n    toast.success('Wallet disconnected');\r\n  };\r\n\r\n  // 切换网络\r\n  const handleSwitchNetwork = async (chainId: number) => {\r\n    try {\r\n      await switchToNetwork(chainId);\r\n      toast.success(`Switched to network ${chainId}`);\r\n    } catch (error: any) {\r\n      console.error('Failed to switch network:', error);\r\n      toast.error(error.message || 'Failed to switch network');\r\n    }\r\n  };\r\n\r\n  // 发送代币交易\r\n  const handleSendTokenTransaction = async (\r\n    contractAddress: string,\r\n    interaction: ContractInteraction\r\n  ): Promise<string> => {\r\n    if (!provider) {\r\n      throw new Error('Wallet not connected');\r\n    }\r\n\r\n    let methodName: string;\r\n    let params: any[] = [];\r\n\r\n    switch (interaction.type) {\r\n      case 'mint':\r\n        methodName = 'mint';\r\n        params = [interaction.to, ethers.utils.parseUnits(interaction.amount, 18)];\r\n        break;\r\n      case 'burn':\r\n        methodName = 'burn';\r\n        params = [ethers.utils.parseUnits(interaction.amount, 18)];\r\n        break;\r\n      case 'transfer':\r\n        methodName = 'transfer';\r\n        params = [interaction.to, ethers.utils.parseUnits(interaction.amount, 18)];\r\n        break;\r\n      default:\r\n        throw new Error(`Unsupported transaction type: ${interaction.type}`);\r\n    }\r\n\r\n    try {\r\n      toast.loading('Preparing transaction...', { id: 'tx-prepare' });\r\n      \r\n      const tx = await sendTransaction(contractAddress, methodName, params, provider);\r\n      \r\n      // 更新交易状态\r\n      const txStatus: TransactionStatus = {\r\n        hash: tx.hash,\r\n        status: 'pending',\r\n        confirmations: 0,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      setTransactions(prev => new Map(prev).set(tx.hash, txStatus));\r\n      \r\n      toast.success('Transaction sent! Waiting for confirmation...', { \r\n        id: 'tx-prepare',\r\n        duration: 3000 \r\n      });\r\n\r\n      // 等待交易确认\r\n      const receipt = await waitForTransaction(tx, 1);\r\n      \r\n      // 更新交易状态\r\n      const updatedStatus: TransactionStatus = {\r\n        hash: tx.hash,\r\n        status: receipt.status === 1 ? 'success' : 'failed',\r\n        confirmations: 1,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      setTransactions(prev => new Map(prev).set(tx.hash, updatedStatus));\r\n\r\n      if (receipt.status === 1) {\r\n        toast.success('Transaction confirmed!', { duration: 5000 });\r\n        // 刷新余额\r\n        setTimeout(() => refreshBalance(), 1000);\r\n      } else {\r\n        toast.error('Transaction failed');\r\n      }\r\n\r\n      return tx.hash;\r\n\r\n    } catch (error: any) {\r\n      console.error('Transaction failed:', error);\r\n      toast.error(error.message || 'Transaction failed');\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // 获取代币余额\r\n  const handleGetTokenBalance = async (\r\n    contractAddress: string,\r\n    userAddress?: string\r\n  ): Promise<string> => {\r\n    if (!provider) {\r\n      throw new Error('Wallet not connected');\r\n    }\r\n\r\n    const address = userAddress || walletInfo.address;\r\n    if (!address) {\r\n      throw new Error('No address provided');\r\n    }\r\n\r\n    try {\r\n      const balance = await getTokenBalance(contractAddress, address, provider);\r\n      return balance;\r\n    } catch (error: any) {\r\n      console.error('Failed to get token balance:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // 清理旧的交易记录\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      const cleanedTransactions = new Map(transactions);\r\n      \r\n      transactions.forEach((status, hash) => {\r\n        const txTime = new Date(status.timestamp).getTime();\r\n        // 保留最近1小时的交易记录\r\n        if (now - txTime > 3600000) {\r\n          cleanedTransactions.delete(hash);\r\n        }\r\n      });\r\n      \r\n      if (cleanedTransactions.size !== transactions.size) {\r\n        setTransactions(cleanedTransactions);\r\n      }\r\n    }, 300000); // 每5分钟清理一次\r\n\r\n    return () => clearInterval(interval);\r\n  }, [transactions]);\r\n\r\n  const contextValue: Web3ContextType = {\r\n    provider,\r\n    isConnected: walletInfo.connected,\r\n    address: walletInfo.address,\r\n    chainId: walletInfo.chainId,\r\n    connectWallet: handleConnectWallet,\r\n    disconnectWallet: handleDisconnectWallet,\r\n    switchNetwork: handleSwitchNetwork,\r\n    sendTokenTransaction: handleSendTokenTransaction,\r\n    getTokenBalance: handleGetTokenBalance,\r\n    isLoading,\r\n    error\r\n  };\r\n\r\n  return (\r\n    <Web3Context.Provider value={contextValue}>\r\n      {children}\r\n    </Web3Context.Provider>\r\n  );\r\n};\r\n\r\nexport const useWeb3 = () => {\r\n  const context = useContext(Web3Context);\r\n  if (context === undefined) {\r\n    throw new Error('useWeb3 must be used within a Web3Provider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport default Web3Provider;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 985, "column": 0}, "map": {"version":3,"sources":["file:///E:/web3/code/TokenBalanceX/token-blance-front/src/app/layout.tsx"],"sourcesContent":["'use client';\n\nimport { Toaster } from 'react-hot-toast';\nimport Web3Provider from '@/contexts/Web3Context';\nimport './globals.css';\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\">\n      <head>\n        <title>TokenBalanceX - Token Balance Tracking System</title>\n        <meta name=\"description\" content=\"Real-time blockchain token balance tracking and points calculation system\" />\n        <link rel=\"icon\" href=\"/favicon.ico\" />\n      </head>\n      <body className=\"bg-gray-50\">\n        <Web3Provider>\n          {children}\n          <Toaster\n            position=\"top-right\"\n            toastOptions={{\n              duration: 4000,\n              style: {\n                background: '#363636',\n                color: '#fff',\n              },\n              success: {\n                duration: 3000,\n                iconTheme: {\n                  primary: '#10b981',\n                  secondary: '#fff',\n                },\n              },\n              error: {\n                duration: 5000,\n                iconTheme: {\n                  primary: '#ef4444',\n                  secondary: '#fff',\n                },\n              },\n            }}\n          />\n        </Web3Provider>\n      </body>\n    </html>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;;AAMe,SAAS,WAAW,EACjC,QAAQ,EAGT;IACC,qBACE,6LAAC;QAAK,MAAK;;0BACT,6LAAC;;kCACC,6LAAC;kCAAM;;;;;;kCACP,6LAAC;wBAAK,MAAK;wBAAc,SAAQ;;;;;;kCACjC,6LAAC;wBAAK,KAAI;wBAAO,MAAK;;;;;;;;;;;;0BAExB,6LAAC;gBAAK,WAAU;0BACd,cAAA,6LAAC,6IAAY;;wBACV;sCACD,6LAAC,qKAAO;4BACN,UAAS;4BACT,cAAc;gCACZ,UAAU;gCACV,OAAO;oCACL,YAAY;oCACZ,OAAO;gCACT;gCACA,SAAS;oCACP,UAAU;oCACV,WAAW;wCACT,SAAS;wCACT,WAAW;oCACb;gCACF;gCACA,OAAO;oCACL,UAAU;oCACV,WAAW;wCACT,SAAS;wCACT,WAAW;oCACb;gCACF;4BACF;;;;;;;;;;;;;;;;;;;;;;;AAMZ;KA3CwB"}}]
}